/**
 * @codekit-append "app/hubJS.js"
 * @codekit-append "app/hubWidget.js"
 *//* **********************************************
     Begin hubJS.js
********************************************** */var hubJS=function(e,t){var n,r={version:0};return{userSettings:{},baseUrl:"http://api.hub.jhu.edu/",init:function(e){n=this;n.userSettings=t.extend({},r,e)},get:function(e,r,i){var r=t.extend({},r);r.v=n.userSettings.version;if(r.id){e=e+"/"+r.id;delete r.id}return t.ajax({url:n.baseUrl+e,dataType:"jsonP",data:r,success:i,fail:n.userSettings.fail})},articles:{find:function(e,r){var e=t.extend({},e);return n.get("articles",e,r)},recent:function(e,r){var i=t.extend({},{per_page:5},{per_page:e});return n.articles.find(i,r)},popular:function(e,r){var e=t.extend({},e,{order_by:"score",score:"trending"});return n.get("articles",e,r)},related:function(e,r,i){var s=r&&r.excluded_ids?e+","+r.excluded_ids:e,r=t.extend({},r,{excluded_ids:s}),o,u=n.articles.find({id:e}),a=u.then(function(e){var i=n.utility.extractEmbeddedItemIds(e,"tags"),s=t.extend({},r,{tags:i.join(",")});return n.articles.find(s)}),f=u.then(function(e){var i=n.utility.extractEmbeddedItemIds(e,"topics"),s=t.extend({},r,{topics:i.join(",")});return f=n.articles.find(s)});a.done(function(e){o=e._embedded.articles?"tags":"topics"});return o=="tags"?a.done(i):f.done(i)}},utility:{extractEmbeddedItemIds:function(e,n){var r=e&&e._embedded&&e._embedded[n]||[];return t.map(r,function(e,t){return e.id})}}}}(window,jQuery),hubWidget=function(e,t){var n,r,i={},s=5;return{init:function(){n=e("#hubWidget");i.title=n.attr("data-title");i.count=n.attr("data-count");i.topics=n.attr("data-topics");i.tags=n.attr("data-tags");var s='<div class="header">'+i.title+"</div>";s+='<div class="content loading"></div>';s+='<div class="hubpower"><a href="http://hub.jhu.edu"><span>Powered by the Hub</span></a></div>';n.html(s);r=this;t.init({v:0});t.baseUrl="http://local.api.hub.jhu.edu/";return r},getArticles:function(){var e=r.utility.compileData();t.articles.find(e,function(e){e.error?r.displayError():r.populateWidget(e._embedded.articles)});return r},populateWidget:function(t){n.find(".content").removeClass("loading");n.find(".content").html(e("<ul>"));e.each(t,function(e,t){var i='<li><p class="headline"><a href="'+t.url+'">'+t.headline+"</a></p>",i=i+'<p class="pubdate">'+r.utility.getPublishDate(t.publish_date)+"</a></p></li>";n.find("ul").append(i)})},utility:{getPublishDate:function(e){var t=new Date(e*1e3),n=r.utility.getMonth(t),i=t.getDate(),s=t.getFullYear();return fullDate=n+" "+i+", "+s},getMonth:function(e){var t=["January","February","March","April","May","June","July","August","September","October","November","December"];return t[e.getMonth()]},compileData:function(){var t={};t.per_page=e.isNumeric(i.count)?i.count:s;i.topics&&(t.topics=r.utility.cleanList(i.topics));i.tags&&(t.tags=r.utility.cleanList(i.tags));return t},cleanList:function(e){return e.replace(/\s/g,"")}},displayError:function(){n.find(".content").html('<p>Sorry, no results were found. Trying checking out <a href="http://hub.jhu.edu">The Hub</a> for the latest Johns Hopkins news.</p>')}}}(jQuery,hubJS);jQuery(document).ready(function(e){hubWidget.init().getArticles()});